# Task ID: 10
# Title: Create ECS container security group (ContainerFromAlbSecurityGroup) for all ECS services
# Status: pending
# Dependencies: 3, 8, 9
# Priority: medium
# Description: Configure a new security group for ECS containers with specific inbound rules allowing traffic from ALB and self-reference, and outbound rules for HTTP/HTTPS traffic to internet and VPC endpoints.
# Details:
1. Create ECS Container Security Group:
   - Use AWS CLI with to-dev-admin profile to create security group in the shared VPC
   - Name: dev-ecs-container-sg-ue2 (ContainerFromAlbSecurityGroup)
   - Description: "Security group for ECS containers allowing traffic from ALB and internal communication"
   - Retrieve VPC ID from EnvironmentBaseStack using AWS CLI
   - Tag with standard tags: Environment=dev, ManagedBy=cdk

2. Configure Inbound Rules:
   - Rule 1: All TCP (0-65535) from 0.0.0.0/0 with Description="Cleanup" (temporary rule for initial setup)
   - Rule 2: All TCP (0-65535) from ALB security group (sg-0f145c092dfa6267b) with Description="FromALB"
   - Rule 3: TCP Port 8080 from self-reference (security group ID) with Description="Loopback"
   - Use aws ec2 authorize-security-group-ingress for each rule

3. Configure Outbound Rules:
   - Rule 1: HTTP (80) to 0.0.0.0/0 (default outbound for package downloads)
   - Rule 2: All TCP (0-65535) to ALB security group (sg-0f145c092dfa6267b) for health checks
   - Rule 3: HTTPS (443) to 0.0.0.0/0 with Description="TODO" (for external API calls)
   - Rule 4: HTTPS (443) to VPC endpoints security group (from Task 9) for AWS service access
   - Use aws ec2 authorize-security-group-egress for each rule

4. Update CDK Code:
   - Add security group creation in appropriate stack (likely TrialFinderV2Stack)
   - Reference the security group in ECS task definitions
   - Ensure proper imports for EC2 constructs
   - Use CDK patterns for security group rules with descriptions

# Test Strategy:
1. Verify Security Group Creation:
   - Run aws ec2 describe-security-groups --filters "Name=group-name,Values=dev-ecs-container-sg-ue2" to confirm creation
   - Validate all inbound rules are correctly configured with proper descriptions
   - Check outbound rules match specifications
   - Ensure security group is in the correct VPC

2. Test Connectivity:
   - Deploy a test ECS task using the new security group
   - Verify ALB can reach containers on all ports (0-65535)
   - Test container-to-container communication on port 8080
   - Confirm containers can reach external HTTPS endpoints

3. Integration Testing:
   - Update ECS service to use new security group
   - Monitor ECS service health checks through ALB
   - Verify containers can access VPC endpoints for AWS services
   - Check CloudWatch logs for any connectivity errors

4. Security Validation:
   - Use AWS Security Hub or Config to validate security group compliance
   - Ensure the 0.0.0.0/0 rule is documented as temporary and tracked for removal
   - Verify principle of least privilege is maintained for production use

# One-Time Setup Scripts

This directory contains scripts that are intended to be run **once** during initial Lake Formation setup or major configuration changes.

## üöÄ Initial Setup Order

Run these scripts in the following order for a new environment:

### 1. Prerequisites Check
```bash
./check-prerequisites.sh [dev|prod]
```
**Purpose**: Validates all prerequisites before Lake Formation setup
**When to run**: Before any Lake Formation deployment
**Run again if**: Adding new AWS accounts or changing Identity Center configuration

### 2. Identity Center Setup (Development)
```bash
./setup-lakeformation-identity-center-dev.sh
```
**Purpose**: Links development Lake Formation to production Identity Center
**When to run**: Once during initial dev environment setup
**Run again if**: Identity Center instance changes or needs reconfiguration

### 3. Identity Center Setup (Production)
```bash
./setup-lakeformation-identity-center-prod.sh
```
**Purpose**: Configures production Lake Formation with Identity Center
**When to run**: Once during initial production environment setup
**Run again if**: Identity Center configuration needs to be reset

### 4. Deploy Data Lake Infrastructure (Optional)
```bash
./deploy-data-lake.sh
```
**Purpose**: Orchestrates CDK deployment of Lake Formation stacks
**When to run**: Initial deployment (consider using GitHub Actions instead)
**Note**: GitHub Actions workflows are preferred for ongoing deployments

## üìÅ Configuration Files

- `lake-formation-identity-center-config-dev.json` - Development Identity Center configuration
- `lake-formation-identity-center-config-prod.json` - Production Identity Center configuration

These files are generated by the setup scripts and store the Identity Center configuration.

## ‚ö†Ô∏è Important Notes

1. **These scripts make permanent changes** to your AWS environment
2. **Production scripts require confirmation** - type "yes" and "PRODUCTION" when prompted
3. **Backups are created automatically** in the `../backups/` directory
4. **Running these scripts multiple times** may cause errors or unintended changes

## üîÑ When to Re-run These Scripts

Only re-run these scripts in the following scenarios:

- **Disaster Recovery**: Restoring Lake Formation after account issues
- **Identity Center Migration**: Moving to a new Identity Center instance
- **Account Migration**: Setting up Lake Formation in a new AWS account
- **Complete Reset**: Removing and recreating all Lake Formation configuration

## üö´ Do NOT Run These Scripts For:

- Regular deployments (use GitHub Actions)
- Permission changes (use CDK or AWS Console)
- Adding new users/groups (use Identity Center console)
- Updating Lake Formation resources (use CDK deployments)

## üìù Pre-Setup Checklist

Before running any script:

- [ ] AWS CLI configured with appropriate profile
- [ ] SSO login completed: `aws sso login --profile <profile>`
- [ ] Confirmed correct AWS account
- [ ] Backed up existing configuration
- [ ] Reviewed script parameters
- [ ] Understood the changes being made

## üÜò Recovery

If something goes wrong:

1. Check the `../backups/` directory for configuration backups
2. Review the log files generated by each script
3. Use AWS Console to manually verify/fix configuration
4. Contact your AWS administrator if needed